<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>Checkout Seguro - Confirma√ß√£o do Pedido</title>
    <!-- Fontes mais profissionais (Exemplo: Inter do Google Fonts) -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        /* Reset e Base */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        html, body {
            width: 100%;
            height: 100%;
            overflow-x: hidden;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: #f8f9fa; /* Fundo mais suave */
            min-height: 100vh;
            padding: 20px;
            color: #212529;
        }

        .container {
            max-width: 800px; /* Aumentado para melhor visualiza√ß√£o em desktop */
            margin: 0 auto;
        }

        /* Header e T√≠tulo */
        .header {
            margin-bottom: 32px;
            text-align: center;
        }

        .header h1 {
            font-size: 2rem;
            font-weight: 800;
            color: #007bff; /* Cor prim√°ria mais profissional */
            margin-bottom: 8px;
            word-break: break-word;
        }

        .header p {
            font-size: 1rem;
            color: #6c757d;
        }

        /* Estrutura Principal */
        .main-grid {
            display: flex;
            flex-direction: column;
            gap: 24px;
        }

        .card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08); /* Sombra mais refinada */
            overflow: hidden;
            width: 100%;
            border: 1px solid #e9ecef; /* Borda sutil */
        }

        .card-header {
            padding: 16px 20px;
            color: white;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.1rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }

        .card-header.blue {
            background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
        }

        .card-header.green {
            background: linear-gradient(135deg, #28a745 0%, #1e7e34 100%);
        }

        .card-header.purple {
            background: linear-gradient(135deg, #6f42c1 0%, #563d7c 100%);
        }

        .card-content {
            padding: 20px;
        }

        /* Bloco Produtos + Resumo */
        .products-summary-block {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            overflow: hidden;
            border: 1px solid #e9ecef;
        }

        .products-section {
            padding: 20px;
            border-bottom: 1px solid #dee2e6;
        }

        .products-header {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 1.1rem;
            font-weight: 700;
            color: #212529;
            margin-bottom: 16px;
        }

        .empty-cart {
            text-align: center;
            padding: 32px 16px;
            color: #adb5bd;
            font-style: italic;
            font-size: 0.95rem;
        }

        .cart-item {
            display: flex;
            gap: 16px;
            padding: 15px 0;
            border-bottom: 1px dashed #e9ecef; /* Linha tracejada para itens */
        }

        .cart-item:last-child {
            border-bottom: none;
        }

        .cart-item-img {
            width: 80px;
            height: 80px;
            object-fit: contain;
            border-radius: 8px;
            background: #f8f9fa;
            padding: 8px;
            flex-shrink: 0;
            border: 1px solid #dee2e6;
        }

        .cart-item-info {
            flex: 1;
            min-width: 0;
        }

        .cart-item-name {
            font-weight: 600;
            color: #212529;
            margin-bottom: 4px;
            font-size: 1rem;
            word-break: break-word;
        }

        .cart-item-model {
            font-size: 0.85rem;
            color: #6c757d;
            margin-bottom: 6px;
        }

        .cart-item-qty {
            font-size: 0.85rem;
            color: #495057;
        }

        .cart-item-price {
            text-align: right;
            flex-shrink: 0;
        }

        .cart-item-subtotal {
            font-weight: 700;
            color: #007bff;
            font-size: 1.1rem;
        }

        .cart-item-unit {
            font-size: 0.75rem;
            color: #adb5bd;
            margin-top: 2px;
        }

        /* Resumo Section */
        .summary-section {
            padding: 20px;
            background: #f8f9fa; /* Fundo mais claro para destaque */
            border-top: 1px solid #dee2e6;
        }

        .summary-header {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 1rem;
            font-weight: 700;
            color: #495057;
            margin-bottom: 16px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .summary-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 12px;
            font-size: 0.95rem;
        }

        .summary-row span:first-child {
            color: #495057;
        }

        .summary-row span:last-child {
            font-weight: 600;
            color: #212529;
        }

        .summary-divider {
            border-top: 1px solid #ced4da;
            padding-top: 16px;
            margin-top: 16px;
        }

        .summary-total {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 1.25rem;
            font-weight: 800;
        }

        .summary-total span:first-child {
            color: #212529;
        }

        .summary-total span:last-child {
            color: #dc3545; /* Cor de destaque para o total a pagar agora */
        }

        .summary-note {
            font-size: 0.85rem;
            color: #6c757d;
            margin-top: 10px;
            text-align: right;
        }

        /* Payment Option (Radio Card) */
        .payment-option {
            display: flex;
            align-items: flex-start;
            gap: 16px;
            padding: 16px;
            border: 2px solid #ced4da;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            background: white;
            min-height: 60px;
            margin-bottom: 12px;
            position: relative;
        }

        .payment-option:last-child {
            margin-bottom: 0;
        }

        .payment-option.selected {
            border-color: #007bff;
            background: #e9f5ff; /* Fundo suave para sele√ß√£o */
            box-shadow: 0 0 0 1px #007bff;
        }

        .payment-option:hover:not(.selected) {
            border-color: #adb5bd;
        }

        .payment-option input[type="radio"] {
            margin-top: 2px;
            cursor: pointer;
            width: 20px;
            height: 20px;
            min-width: 20px;
            accent-color: #007bff;
        }

        .payment-option-text {
            flex: 1;
        }

        .payment-option-text h3 {
            font-weight: 700;
            color: #212529;
            margin-bottom: 4px;
            font-size: 1rem;
        }

        .payment-option-text p {
            font-size: 0.85rem;
            color: #6c757d;
        }

        /* Form Styles */
        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            font-weight: 600;
            color: #212529;
            margin-bottom: 8px;
            font-size: 0.95rem;
        }

        .form-group input {
            width: 100%;
            padding: 12px;
            border: 1px solid #ced4da;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.2s;
            font-family: inherit;
            -webkit-appearance: none;
            appearance: none;
            background-color: #fff;
        }

        .form-group input:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.25);
        }

        .form-group input:disabled {
            background: #e9ecef;
            color: #6c757d;
            cursor: not-allowed;
        }

        .form-group-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }

        /* CEP Input Group */
        .cep-input-group {
            display: flex;
            gap: 10px;
        }

        .cep-input-group input {
            flex: 1;
        }

        .cep-input-group button {
            padding: 12px 20px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 1rem;
            white-space: nowrap;
            flex-shrink: 0;
            -webkit-appearance: none;
            appearance: none;
            min-height: 48px;
        }

        .cep-input-group button:hover:not(:disabled) {
            background: #0056b3;
        }

        .cep-input-group button:active:not(:disabled) {
            background: #004085;
            transform: scale(0.98);
        }

        .cep-input-group button:disabled {
            background: #adb5bd;
            cursor: not-allowed;
            opacity: 0.8;
        }

        .cep-input-group button.loading {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .spinner {
            width: 18px;
            height: 18px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 0.6s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Alerts */
        .alert {
            padding: 12px 16px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 0.95rem;
            font-weight: 600;
        }

        .alert.error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .alert.info {
            background-color: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        .alert-icon {
            font-size: 1.2rem;
        }

        /* Buttons */
        .btn-primary {
            width: 100%;
            padding: 15px 20px;
            background: #28a745; /* Cor de sucesso para o bot√£o principal */
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 700;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.2s;
            -webkit-appearance: none;
            appearance: none;
        }

        .btn-primary:hover:not(:disabled) {
            background: #1e7e34;
        }

        .btn-primary:active:not(:disabled) {
            background: #155724;
            transform: scale(0.99);
        }

        .btn-primary:disabled {
            background: #adb5bd;
            cursor: not-allowed;
            opacity: 0.8;
        }

        /* Step Navigation */
        .checkout-step {
            display: none;
            animation: fadeIn 0.3s ease-in-out;
        }

        .checkout-step.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Step 2 Summary Details */
        .summary-details {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            border: 1px solid #e9ecef;
        }

        .summary-details h2 {
            font-size: 1.2rem;
            font-weight: 700;
            color: #007bff;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e9ecef;
        }

        .summary-details p {
            margin-bottom: 8px;
            font-size: 0.95rem;
            color: #495057;
        }

        .summary-details strong {
            color: #212529;
        }

        .total-final {
            margin-top: 20px;
            padding-top: 15px;
            border-top: 2px solid #28a745;
            display: flex;
            justify-content: space-between;
            font-size: 1.2rem;
            font-weight: 800;
            color: #dc3545;
        }

        /* Responsive */
        @media (max-width: 640px) {
            body {
                padding: 16px;
            }

            .header h1 {
                font-size: 1.75rem;
            }

            .main-grid {
                gap: 16px;
            }

            .card-content {
                padding: 16px;
            }

            .products-section, .summary-section {
                padding: 16px;
            }

            .form-group-row {
                grid-template-columns: 1fr; /* Colunas em linha √∫nica em mobile */
                gap: 12px;
            }

            .cart-item {
                gap: 12px;
                padding: 12px 0;
            }

            .cart-item-img {
                width: 60px;
                height: 60px;
            }

            .summary-total {
                font-size: 1.1rem;
            }

            .btn-primary {
                font-size: 1rem;
                padding: 14px 20px;
            }
        }

        /* Corre√ß√£o para iOS */
        @supports (padding: max(0px)) {
            body {
                padding-left: max(16px, env(safe-area-inset-left));
                padding-right: max(16px, env(safe-area-inset-right));
                padding-bottom: max(16px, env(safe-area-inset-bottom));
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Passo 1: Confirma√ß√£o do Pedido e Endere√ßo -->
        <div id="step-1" class="checkout-step active">
            <!-- Header -->
            <div class="header">
                <h1>Confirma√ß√£o do Pedido</h1>
                <p>Revise seus itens e informe o endere√ßo de entrega.</p>
            </div>

            <!-- Main Grid -->
            <div class="main-grid">
                <!-- Produtos + Resumo Unified Block -->
                <div class="products-summary-block">
                    <!-- Produtos Section -->
                    <div class="products-section">
                        <div class="products-header">
                            <span>üõí</span> Itens do Pedido
                        </div>
                        <div id="cart-items-container">
                            <div class="empty-cart">Seu carrinho est√° vazio.</div>
                        </div>
                    </div>

                    <!-- Resumo Section -->
                    <div class="summary-section">
                        <div class="summary-header">
                            <span>üìù</span> Resumo de Valores
                        </div>
                        <div class="summary-row">
                            <span>Subtotal dos Produtos</span>
                            <span id="subtotal">R$ 0,00</span>
                        </div>
                        <div class="summary-row">
                            <span>Taxa de Servi√ßo (Envio/Instala√ß√£o)</span>
                            <span id="complemento-valor">R$ 0,00</span>
                        </div>
                        <div class="summary-divider">
                            <div class="summary-total">
                                <span>Total a Pagar Agora</span>
                                <span id="total-agora">R$ 0,00</span>
                            </div>
                        </div>
                        <p class="summary-note">
                            *O valor dos produtos ser√° pago **apenas na entrega**.
                        </p>
                    </div>
                </div>

                <!-- M√©todo de Pagamento Card -->
                <div class="card">
                    <div class="card-header green">
                        <span>‚úÖ</span> Pagamento dos Produtos
                    </div>
                    <div class="card-content">
                        <label class="payment-option selected" id="payment-option-cash">
                            <input type="radio" name="payment" value="cash" checked disabled>
                            <div class="payment-option-text">
                                <h3>Pagamento na Entrega (Produtos)</h3>
                                <p>O valor total dos produtos ser√° pago no momento do recebimento. **N√£o h√° cobran√ßa agora.**</p>
                            </div>
                        </label>
                    </div>
                </div>

                <!-- Endere√ßo de Entrega Card -->
                <div class="card">
                    <div class="card-header purple">
                        <span>üè†</span> Endere√ßo de Entrega
                    </div>
                    <div class="card-content">
                        <!-- CEP Input -->
                        <div class="form-group">
                            <label for="cep">CEP</label>
                            <div class="cep-input-group">
                                <input 
                                    type="text" 
                                    id="cep" 
                                    placeholder="00000-000" 
                                    maxlength="9"
                                    inputmode="numeric"
                                >
                                <button id="btn-search-cep">Buscar CEP</button>
                            </div>
                        </div>

                        <!-- Error Alert -->
                        <div id="cep-error" class="alert error" style="display: none;">
                            <span class="alert-icon">‚ö†Ô∏è</span>
                            <span id="error-message"></span>
                        </div>

                        <!-- Address Fields -->
                        <div id="address-fields" class="address-fields" style="display: none;">
                            <div class="form-group-row">
                                <div class="form-group">
                                    <label for="logradouro">Logradouro</label>
                                    <input type="text" id="logradouro" disabled>
                                </div>
                                <div class="form-group">
                                    <label for="bairro">Bairro</label>
                                    <input type="text" id="bairro" disabled>
                                </div>
                            </div>

                            <div class="form-group-row">
                                <div class="form-group">
                                    <label for="uf">Estado (UF)</label>
                                    <input type="text" id="uf" disabled>
                                </div>
                                <div class="form-group">
                                    <label for="numero">N√∫mero *</label>
                                    <input type="text" id="numero" placeholder="Ex: 123" inputmode="numeric">
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="complemento">Complemento (Opcional)</label>
                                <input type="text" id="complemento" placeholder="Ex: Apto 101, Bloco B">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Op√ß√µes de Servi√ßo Card -->
                <div class="card">
                    <div class="card-header blue">
                        <span>üöö</span> Selecione o Servi√ßo
                    </div>
                    <div class="card-content">
                        <div class="form-group" id="complemento-options-container">
                            <label>Escolha a op√ß√£o de envio e/ou instala√ß√£o:</label>
                            <label class="payment-option" data-valor="35.90" data-link="LINK_ENVIO_35_90">
                                <input type="radio" name="complemento-option" value="envio" checked>
                                <div class="payment-option-text">
                                    <h3>Envio Expresso</h3>
                                    <p>Receba seu pedido amanh√£. Custo: R$ 35,90</p>
                                </div>
                            </label>
                            <label class="payment-option" data-valor="43.90" data-link="LINK_ENVIO_INSTALACAO_43_90">
                                <input type="radio" name="complemento-option" value="envio-instalacao">
                                <div class="payment-option-text">
                                    <h3>Envio + Instala√ß√£o Completa</h3>
                                    <p>Receba amanh√£ com instala√ß√£o profissional inclusa. Custo: R$ 43,90</p>
                                </div>
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Bot√£o Prosseguir -->
                <button id="btn-prosseguir" class="btn-primary" disabled>
                    Prosseguir para o Resumo
                </button>
                <p class="summary-note" style="text-align: center; margin-top: 10px;">
                    Ao prosseguir, voc√™ ser√° levado para a tela de resumo e pagamento da Taxa de Servi√ßo.
                </p>
            </div>
        </div>

        <!-- Passo 2: Resumo e Finaliza√ß√£o -->
        <div id="step-2" class="checkout-step">
            <div class="header">
                <h1>Resumo e Pagamento</h1>
                <p>Confirme os detalhes e finalize o pagamento da Taxa de Servi√ßo.</p>
            </div>

            <div class="main-grid">
                <!-- Detalhes do Pedido -->
                <div class="summary-details">
                    <h2>Itens do Pedido</h2>
                    <div id="summary-products-list"></div>
                </div>

                <!-- Detalhes do Endere√ßo -->
                <div class="summary-details">
                    <h2>Endere√ßo de Entrega</h2>
                    <p><strong>CEP:</strong> <span id="summary-cep"></span></p>
                    <p><strong>Endere√ßo:</strong> <span id="summary-address"></span></p>
                    <p><strong>Bairro:</strong> <span id="summary-bairro"></span></p>
                    <p><strong>Estado:</strong> <span id="summary-uf"></span></p>
                    <p><strong>Complemento:</strong> <span id="summary-complemento-text"></span></p>
                </div>

                <!-- Detalhes do Servi√ßo -->
                <div class="summary-details">
                    <h2>Servi√ßo Selecionado</h2>
                    <p><strong>Op√ß√£o:</strong> <span id="summary-complemento-option"></span></p>
                    <div class="total-final">
                        <span>Total a Pagar Agora:</span>
                        <span id="summary-total-agora">R$ 0,00</span>
                    </div>
                    <p class="summary-note" style="text-align: left; margin-top: 10px;">
                        *O valor dos produtos (<span id="summary-subtotal-produtos">R$ 0,00</span>) ser√° pago apenas na entrega.
                    </p>
                </div>

                <!-- Bot√£o Voltar -->
                <button id="btn-voltar" class="btn-primary" style="background: #6c757d; margin-bottom: 10px;">
                    ‚Üê Voltar e Editar
                </button>

                <!-- Bot√£o Finalizar -->
                <button id="btn-finalizar" class="btn-primary">
                    Finalizar Pedido (Pagar <span id="btn-finalizar-valor">R$ 0,00</span>)
                </button>
                <p class="summary-note" style="text-align: center; margin-top: 10px;">
                    Voc√™ ser√° redirecionado para o link de pagamento seguro da Taxa de Servi√ßo.
                </p>
            </div>
        </div>
    </div>

    <script>
        // Cat√°logo de Pe√ßas (Mantido para simula√ß√£o)
        const catalogoPecas = [
            { id: 101, nome: "Moura M50ED - 50Ah", preco: 349.90, modelo: "Automotiva", estoque: 50, imagem_url: "https://cdn.shopify.com/s/files/1/0771/3115/3652/files/17303139164879-moura_pack_frontal_a-684b0da176fa5_1.png?v=1762392888" },
            { id: 102, nome: "Moura M60AD - 60Ah", preco: 499.90, modelo: "Automotiva", estoque: 50, imagem_url: "https://cdn.shopify.com/s/files/1/0771/3115/3652/files/17303139164879-moura_pack_frontal_a-684b0da176fa5_1.png?v=1762392888" },
            { id: 103, nome: "Moura M70AE - 70Ah", preco: 619.90, modelo: "Automotiva", estoque: 32, imagem_url: "https://cdn.shopify.com/s/files/1/0771/3115/3652/files/17303139164879-moura_pack_frontal_a-684b0da176fa5_1.png?v=1762392888" },
            { id: 104, nome: "Moura Moto MA5-D - 5Ah", preco: 189.90, modelo: "Moto", estoque: 21, imagem_url: "https://cdn.shopify.com/s/files/1/0771/3115/3652/files/17303139164879-moura_pack_frontal_a-684b0da176fa5_1.png?v=1762392888" },
            { id: 105, nome: "Moura Moto MA9-E - 9Ah", preco: 279.90, modelo: "Moto", estoque: 21, imagem_url: "https://i.imgur.com/M7q1z0Z.png" },
            { id: 106, nome: "Moura Estacion√°ria Clean 100Ah", preco: 1250.00, modelo: "Estacion√°ria", estoque: 21, imagem_url: "https://i.imgur.com/M7q1z0Z.png" },
        ];

        // Dados das op√ß√µes de servi√ßo (Envio/Instala√ß√£o)
        const complementoOptions = {
            'envio': {
                valor: 35.90,
                descricao: 'Envio Expresso',
                linkPagamento: 'LINK_ENVIO_35_90' // Placeholder
            },
            'envio-instalacao': {
                valor: 43.90,
                descricao: 'Envio + Instala√ß√£o Completa',
                linkPagamento: 'LINK_ENVIO_INSTALACAO_43_90' // Placeholder
            }
        };

        // Estado Global
        // Simula√ß√£o de um carrinho com itens
        let carrinho = [
            { id: 102, quantidade: 1 },
            { id: 104, quantidade: 2 }
        ];
        let endereco = {
            cep: '',
            logradouro: '',
            bairro: '',
            uf: '',
            numero: '',
            complemento: ''
        };
        let complementoSelecionado = 'envio'; // Padr√£o

        // DOM Elements - Step 1
        const step1 = document.getElementById('step-1');
        const cepInput = document.getElementById('cep');
        const btnSearchCep = document.getElementById('btn-search-cep');
        const cepError = document.getElementById('cep-error');
        const errorMessage = document.getElementById('error-message');
        const addressFields = document.getElementById('address-fields');
        const cartItemsContainer = document.getElementById('cart-items-container');
        const subtotalEl = document.getElementById('subtotal');
        const complementoValorEl = document.getElementById('complemento-valor');
        const totalAgoraEl = document.getElementById('total-agora');
        const btnProsseguir = document.getElementById('btn-prosseguir');
        const complementoOptionsContainer = document.getElementById('complemento-options-container');
        const numeroInput = document.getElementById('numero');
        const complementoInput = document.getElementById('complemento');

        // DOM Elements - Step 2
        const step2 = document.getElementById('step-2');
        const summaryProductsList = document.getElementById('summary-products-list');
        const summaryCep = document.getElementById('summary-cep');
        const summaryAddress = document.getElementById('summary-address');
        const summaryBairro = document.getElementById('summary-bairro');
        const summaryUf = document.getElementById('summary-uf');
        const summaryComplementoText = document.getElementById('summary-complemento-text');
        const summaryComplementoOption = document.getElementById('summary-complemento-option');
        const summaryTotalAgora = document.getElementById('summary-total-agora');
        const summarySubtotalProdutos = document.getElementById('summary-subtotal-produtos');
        const btnFinalizar = document.getElementById('btn-finalizar');
        const btnFinalizarValor = document.getElementById('btn-finalizar-valor');
        const btnVoltar = document.getElementById('btn-voltar');

        // Fun√ß√µes de Formata√ß√£o
        const formatCurrency = (value) => `R$ ${value.toFixed(2).replace('.', ',')}`;

        // 1. Renderizar Carrinho
        function renderizarCarrinho() {
            let html = '';
            let subtotalProdutos = 0;

            if (carrinho.length === 0) {
                cartItemsContainer.innerHTML = '<div class="empty-cart">Seu carrinho est√° vazio.</div>';
                return;
            }

            carrinho.forEach(itemCarrinho => {
                const produto = catalogoPecas.find(p => p.id === itemCarrinho.id);
                if (produto) {
                    const subtotalItem = produto.preco * itemCarrinho.quantidade;
                    subtotalProdutos += subtotalItem;

                    html += `
                        <div class="cart-item">
                            <img src="${produto.imagem_url}" alt="${produto.nome}" class="cart-item-img">
                            <div class="cart-item-info">
                                <div class="cart-item-name">${produto.nome}</div>
                                <div class="cart-item-model">${produto.modelo}</div>
                                <div class="cart-item-qty">Qtd: ${itemCarrinho.quantidade} x ${formatCurrency(produto.preco)}</div>
                            </div>
                            <div class="cart-item-price">
                                <div class="cart-item-subtotal">${formatCurrency(subtotalItem)}</div>
                                <div class="cart-item-unit">Total</div>
                            </div>
                        </div>
                    `;
                }
            });

            cartItemsContainer.innerHTML = html;
            subtotalEl.textContent = formatCurrency(subtotalProdutos);
            atualizarTotais();
        }

        // 2. Atualizar Totais
        function atualizarTotais() {
            const subtotalProdutos = parseFloat(subtotalEl.textContent.replace('R$', '').replace(',', '.'));
            const complemento = complementoOptions[complementoSelecionado];
            const valorComplemento = complemento ? complemento.valor : 0;

            complementoValorEl.textContent = formatCurrency(valorComplemento);
            totalAgoraEl.textContent = formatCurrency(valorComplemento);
            btnFinalizarValor.textContent = formatCurrency(valorComplemento);
        }

        // 3. L√≥gica de Sele√ß√£o de Servi√ßo
        complementoOptionsContainer.addEventListener('change', (e) => {
            if (e.target.name === 'complemento-option') {
                complementoSelecionado = e.target.value;
                document.querySelectorAll('#complemento-options-container .payment-option').forEach(label => {
                    label.classList.remove('selected');
                });
                e.target.closest('.payment-option').classList.add('selected');
                atualizarTotais();
                validarFormulario();
            }
        });

        // 4. Fun√ß√µes de Endere√ßo
        function mostrarErro(mensagem) {
            errorMessage.textContent = mensagem;
            cepError.style.display = 'flex';
            addressFields.style.display = 'none';
            // Limpar campos de endere√ßo ao mostrar erro
            document.getElementById('logradouro').value = '';
            document.getElementById('bairro').value = '';
            document.getElementById('uf').value = '';
            numeroInput.value = '';
            complementoInput.value = '';
            endereco = { cep: cepInput.value, logradouro: '', bairro: '', uf: '', numero: '', complemento: '' };
            validarFormulario();
        }

        function preencherEndereco() {
            document.getElementById('logradouro').value = endereco.logradouro;
            document.getElementById('bairro').value = endereco.bairro;
            document.getElementById('uf').value = endereco.uf;
            // O n√∫mero e complemento s√£o preenchidos pelo usu√°rio, n√£o pelo CEP
            numeroInput.focus(); // Foca no campo n√∫mero
        }

        async function buscarCep() {
            const cepLimpo = cepInput.value.replace(/\D/g, '');

            if (cepLimpo.length !== 8) {
                mostrarErro('CEP deve conter 8 d√≠gitos');
                return;
            }

            btnSearchCep.disabled = true;
            btnSearchCep.classList.add('loading');
            btnSearchCep.innerHTML = '<span class="spinner"></span>';
            cepError.style.display = 'none';

            try {
                // Simula√ß√£o de busca de CEP (substituir por API real)
                const response = await fetch(`https://viacep.com.br/ws/${cepLimpo}/json/`);
                const data = await response.json();

                if (data.erro) {
                    mostrarErro('CEP n√£o encontrado ou inv√°lido.');
                    return;
                }

                endereco = {
                    cep: cepInput.value,
                    logradouro: data.logradouro || '',
                    bairro: data.bairro || '',
                    uf: data.uf || '',
                    numero: numeroInput.value,
                    complemento: complementoInput.value
                };

                preencherEndereco();
                addressFields.style.display = 'grid';
                cepError.style.display = 'none';
                
                // Scroll para campos de endere√ßo
                setTimeout(() => {
                    numeroInput.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }, 300);
            } catch (error) {
                mostrarErro('Erro ao buscar CEP. Verifique sua conex√£o.');
                console.error('Erro:', error);
            } finally {
                btnSearchCep.disabled = false;
                btnSearchCep.classList.remove('loading');
                btnSearchCep.textContent = 'Buscar CEP';
                validarFormulario();
            }
        }

        // 5. Valida√ß√£o e Intera√ß√£o do Formul√°rio
        function validarFormulario() {
            const cepValido = endereco.cep.replace(/\D/g, '').length === 8;
            const numeroPreenchido = numeroInput.value.trim() !== '';
            const logradouroPreenchido = endereco.logradouro.trim() !== '';

            const isFormValid = cepValido && numeroPreenchido && logradouroPreenchido;

            btnProsseguir.disabled = !isFormValid;
        }

        // Listeners para valida√ß√£o
        cepInput.addEventListener('input', (e) => {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length > 8) value = value.slice(0, 8);
            if (value.length > 5) {
                value = value.slice(0, 5) + '-' + value.slice(5);
            }
            e.target.value = value;
            endereco.cep = value;
            validarFormulario();
        });

        numeroInput.addEventListener('input', (e) => {
            endereco.numero = e.target.value;
            validarFormulario();
        });

        complementoInput.addEventListener('input', (e) => {
            endereco.complemento = e.target.value;
        });

        // 6. L√≥gica de Navega√ß√£o (Passos)
        function irParaPasso(passo) {
            if (passo === 1) {
                step2.classList.remove('active');
                step1.classList.add('active');
                window.scrollTo({ top: 0, behavior: 'smooth' });
            } else if (passo === 2) {
                if (!btnProsseguir.disabled) {
                    preencherResumo();
                    step1.classList.remove('active');
                    step2.classList.add('active');
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                }
            }
        }

        // 7. Preencher Resumo (Passo 2)
        function preencherResumo() {
            // Endere√ßo
            summaryCep.textContent = endereco.cep;
            summaryAddress.textContent = `${endereco.logradouro}, ${endereco.numero}`;
            summaryBairro.textContent = endereco.bairro;
            summaryUf.textContent = endereco.uf;
            summaryComplementoText.textContent = endereco.complemento || 'Nenhum';

            // Servi√ßo
            const servico = complementoOptions[complementoSelecionado];
            summaryComplementoOption.textContent = servico.descricao;
            summaryTotalAgora.textContent = formatCurrency(servico.valor);

            // Produtos (Reutiliza a l√≥gica de renderiza√ß√£o do carrinho para o resumo)
            let resumoProdutosHtml = '';
            let subtotalProdutos = 0;
            carrinho.forEach(itemCarrinho => {
                const produto = catalogoPecas.find(p => p.id === itemCarrinho.id);
                if (produto) {
                    const subtotalItem = produto.preco * itemCarrinho.quantidade;
                    subtotalProdutos += subtotalItem;
                    resumoProdutosHtml += `<p>${itemCarrinho.quantidade}x ${produto.nome} (${formatCurrency(subtotalItem)})</p>`;
                }
            });
            summaryProductsList.innerHTML = resumoProdutosHtml;
            summarySubtotalProdutos.textContent = formatCurrency(subtotalProdutos);
        }

        // 8. Listeners de Navega√ß√£o
        btnProsseguir.addEventListener('click', () => irParaPasso(2));
        btnVoltar.addEventListener('click', () => irParaPasso(1));

        // 9. Listener de Finaliza√ß√£o
        btnFinalizar.addEventListener('click', () => {
            const servico = complementoOptions[complementoSelecionado];
            // Simula√ß√£o de redirecionamento para pagamento
            alert(`Redirecionando para o link de pagamento seguro:\nServi√ßo: ${servico.descricao}\nValor: ${formatCurrency(servico.valor)}\nLink: ${servico.linkPagamento}`);
            // window.location.href = servico.linkPagamento; // A√ß√£o real
        });

        // Inicializa√ß√£o
        document.addEventListener('DOMContentLoaded', () => {
            renderizarCarrinho();
            validarFormulario();
        });
    </script>
</body>
</html>
